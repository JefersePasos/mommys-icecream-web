<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:attr="lang=${#locale.language}">
    <head>
        <meta charset="UTF-8" />
        <title th:text="#{roles.tituloDashboard}">Roles Dashboard</title>
        <link rel="stylesheet" href="/css/estilos.css" />
    </head>
    <body> 
        <header>
            <div class="navbar">
                <a class="brand" th:href="@{/}">
                    <img th:src="@{/img/logo.png}" alt="Logo Mommy's ice cream" />
                    <h1>
                        <span th:text="${brandLine1} ?: 'Mommy’s'"></span>
                        <span th:text="${brandLine2} ?: 'Ice Cream'"></span>
                    </h1>
                </a>

                <nav class="nav-menu">
                    <a th:href="@{/comprar}"        th:text="#{nav.comprar}">Comprar</a>
                    <a th:href="@{/productos/catalogo}"       th:text="#{nav.catalogo}">Catálogo</a>
                    <a th:href="@{/sobre-nosotros}" th:text="#{nav.sobreNosotros}">Sobre Nosotros</a>
                    <a th:href="@{/contacto}"       th:text="#{nav.contacto}">Contáctenos</a>
                </nav>

                <div class="nav-actions">
                    <form method="get">
                        <select class="lang-select" name="lang" aria-label="Idioma" onchange="this.form.submit()">
                            <option value="es" th:selected="${#locale.language == 'es'}">ES</option>
                            <option value="en" th:selected="${#locale.language == 'en'}">EN</option>
                        </select>
                    </form>
                    <a th:href="@{/carrito}" title="Carrito"</a>
                    <img th:src="@{/img/carrito.png}" alt="Carrito" style="width:28px;height:28px;object-fit:cover;" />
                    <a th:href="@{/login}" title="Cuenta">
                        <img th:src="@{/img/cuenta.png}" alt="Perfil" style="width:28px;height:28px;object-fit:cover;border-radius:50%;" />
                    </a>
                </div>
            </div>
        </header>
        <div class="centrado">

            <div class="contenedor-formulario" style="max-width: 900px;">

                <!-- Tabla de usuarios con sus roles -->
                <h2 th:text="#{roles.tituloPanel}">Roles Administration Panel</h2>
                <div th:if="${session.errorRol}" class="error" th:text="${session.errorRol}"></div>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="text-align: left;" th:text="#{tabla.nombre}">Name</th>
                            <th style="text-align: left;" th:text="#{tabla.correo}">Email</th>
                            <th style="text-align: left;" th:text="#{roles.rolActual}">Current Role</th>
                            <th style="text-align: center;" th:text="#{boton.acciones}">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="usuario : ${usuarios}">
                            <td th:text="${usuario.nombre} + ' ' + ${usuario.primerApellido}"></td>
                            <td th:text="${usuario.correo}"></td>
                            <td th:text="${usuario.rol.nombre}"></td>
                            <td>
                                <form th:action="@{'/admin/roles/asignar/' + ${usuario.id}}" method="get" style="display:inline;">
                                    <button type="submit" th:text="#{roles.changeRole}">Change role</button>
                                </form>
                                <form th:if="${usuario.rol.nombre != 'Cliente'}"
                                      th:action="@{'/admin/roles/confirmar-revocacion/' + ${usuario.id}}" method="get"
                                      style="display:inline;">
                                    <button type="submit" style="background-color: #ffe6e6; color: #b30000;" th:text="#{roles.revocar}">Revoke</button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Tabla de roles existentes -->
                <h3 style="margin-top: 2em;" th:text="#{roles.rolesExistentes}">Existing roles</h3>
                <table style="width: 100%; border-collapse: collapse; border-spacing: 0;">
                    <thead>
                        <tr style="border-bottom: 2px solid #f2f2f2;">
                            <th style="text-align: left; padding: 8px;" th:text="#{roles.nombre}">Role Name:</th>
                            <th style="text-align: center; padding: 8px;" th:text="#{roles.estado}">State</th>
                            <th style="text-align: center; padding: 8px;" th:text="#{boton.acciones}">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="rol : ${roles}" style="border-bottom: 1px solid #e0e0e0;">
                            <td th:text="${rol.nombre}" style="padding: 10px 8px;"></td>
                            <td th:text="${rol.activo} ? #{estado.activo} : #{estado.inactivo}"
                                style="text-align:center; padding: 10px 8px;"></td>
                            <td style="text-align:center; padding: 10px 8px;">
                                <form th:action="@{'/admin/roles/editar/' + ${rol.id}}" method="get" style="display:inline;">
                                    <button type="submit" style="margin-right:0.5em;" th:text="#{boton.editar}">Edit</button>
                                </form>

                                <form th:if="${rol.nombre != 'Administrador' and rol.nombre != 'Cliente'}"
                                      th:action="@{'/admin/roles/inactivar/' + ${rol.id}}"
                                      method="post" style="display:inline;">
                                    <button type="submit" style="margin-right:0.5em;" th:text="#{roles.desactivar}">Deactivate</button>
                                </form>

                                <form th:if="${rol.nombre != 'Administrador' and rol.nombre != 'Cliente'}"
                                      th:action="@{'/admin/roles/eliminar/' + ${rol.id}}"
                                      method="post"
                                      onsubmit="return confirm('#{roles.confirmarEliminacion}');"
                                      style="display:inline;">
                                    <button type="submit" style="background-color:#ffd6d6;color:#800000;" th:text="#{boton.borrar}">Delete</button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 2em;">
                    <form action="/admin/roles/crear" method="get">
                        <button type="submit">➕ <span th:text="#{roles.crearNuevoRol}">Create new role</span></button>
                    </form>
                </div>

                <div style="margin-top: 2em;">
                    <a href="/perfil">
                        <button style="background-color: var(--gris); color: var(--texto);" th:text="#{boton.volver}">Back</button>
                    </a>
                </div>
            </div> 
        </div>
    <script src="/js/lang.js"></script>
    </body>
</html>
