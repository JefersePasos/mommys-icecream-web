<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Detalle del Pedido</title>
  <link rel="stylesheet" th:href="@{/css/estilos.css}" />
</head>

<body>
  <header>
    <div class="navbar">
      <a class="brand" th:href="@{/}">
        <img th:src="@{/img/logo.png}" alt="Logo Mommy's Ice Cream" />
        <h1>Mommy’s <span>Ice Cream</span></h1>
      </a>
    </div>
  </header>

  <main class="centrado">
    <div class="contenedor-formulario" style="max-width: 900px;">
        <h2>Detalle del Pedido</h2>

        <p><strong>ID Pedido:</strong> <span th:text="${pedido.id}"></span></p>
        <p><strong>Fecha:</strong> <span th:text="${#temporals.format(pedido.created_at, 'yyyy-MM-dd HH:mm')}"></span></p>
        <p><strong>Estado:</strong>
            <span th:text="${pedido.orderStatus} ? 'Confirmado' : 'Pendiente'"></span>
        </p>

        <form th:action="@{/compras/historial}" method="get" style="margin-bottom: 20px;">
  
            <label>Desde:</label>
            <input type="date" name="desde" />

            <label>Hasta:</label>
            <input type="date" name="hasta" />

            <label>Estado:</label>
            <select name="estado">
                <option value="">Todos</option>
                <option value="true">Confirmado</option>
                <option value="false">Pendiente</option>
            </select>

            <label>Últimos meses:</label>
            <select name="meses">
                <option value="0">—</option>
                <option value="1">1 mes</option>
                <option value="3">3 meses</option>
                <option value="6">6 meses</option>
            </select>

            <button class="btn" type="submit">Filtrar</button>
        </form>

        <table class="factura-table">
            <thead>
                <tr>
                    <th>Cantidad</th>
                    <th>Producto</th>
                    <th>Precio unidad</th>
                    <th>Subtotal</th>
                </tr>
            </thead>

            <tbody>
                <tr th:each="pp : ${pedido.productos}">
                    <td data-label="Cantidad" th:text="${pp.cantidad}"></td>
                    <td data-label="Producto" th:text="${pp.producto.sabor}"></td>
                    <td data-label="Precio unidad" th:text="${pp.precio}"></td>
                    <td data-label="Subtotal" th:text="${pp.cantidad * pp.precio}"></td>
                </tr>
            </tbody>
        </table>

        <div class="factura-total">
            Total: <span th:text="${pedido.totalColones}"></span>
        </div>

        <a th:href="@{'/compras/pedidos/pdf/' + ${pedido.id}}">
            <button class="btn" style="margin-top: 20px;">Descargar Factura PDF</button>
        </a>

        <a th:href="@{/compras/historial}">
            <button class="btn">Volver al Historial</button>
        </a>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Mommy's Ice Cream</p>
  </footer>
</body>
</html>